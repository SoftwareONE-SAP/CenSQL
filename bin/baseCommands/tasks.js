
var DPTasksCommandHandler = function(){
	this.includeInAudit = true;
}

DPTasksCommandHandler.prototype.run = function(command, cParts, conn, screen, callback){

	conn.exec("conn", 'SELECT E.HOST, E.PORT, E.TASK_NAME, LAST_VALUE(E.TASK_EXECUTION_ID ORDER BY E.START_TIME) AS LAST_EXECUTION_ID, LAST_VALUE(E.START_TIME ORDER BY E.START_TIME) AS LAST_START_TIME, LAST_VALUE(E.END_TIME ORDER BY E.START_TIME) AS LAST_END_TIME, LAST_VALUE(E.STATUS ORDER BY E.START_TIME) AS LAST_STATUS, LAST_VALUE(E.TOTAL_PROGRESS_PERCENT ORDER BY E.START_TIME) AS PROGRESS, LAST_VALUE(E.PROCESSED_RECORDS ORDER BY E.START_TIME) AS RECORDS_PROGRESSED, LAST_VALUE(M.MESSAGE_TEXT ORDER BY E.START_TIME) AS MESSAGE FROM "_SYS_TASK"."TASK_EXECUTIONS" AS E LEFT JOIN _SYS_TASK.START_TASK_MESSAGES AS M ON (E.TASK_EXECUTION_ID = M.TASK_EXECUTION_ID) WHERE E.PARENT_TASK_EXECUTION_ID = 0 AND E.CURRENT_OPERATION = \'TASK\' GROUP BY E.HOST, E.PORT, E.TASK_NAME ORDER BY LAST_VALUE(E.START_TIME ORDER BY E.START_TIME) DESC', function(err, data) {
	    callback([err == null ? 0 : 1, err == null ? data : err, err == null ? "default" : "sql-error"]);
	})
}

module.exports = DPTasksCommandHandler;